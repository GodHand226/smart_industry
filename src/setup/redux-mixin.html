<link rel="import" href="/bower_components/polymer-redux/polymer-redux.html">
<script src="/node_modules/redux/dist/redux.min.js"></script>
<script>
    const initial = {
        machines: [],
        editMachines: []
    };
    // helper function
    const remove = (index, data) => index === 0 ? data.slice(1) : [
        ...data.slice(0, index),
        ...data.slice(index + 1, data.length)
    ]
    // Object.assign({}, state === ...state to prevent arr mutation
    // remove(action.index, state.machines) === [...state.editMchines.slice(0, action.index), ...state.editMachines.slice(action.index + 1)] 
    const reducer = (state, action) => {
        if (!state) return initial;
        switch (action.type) {
            case 'ADD_MACHINE':
                delete action.machines["$key"]
                return {
                    ...state,
                    machines: [...state.machines, action.machines]
                }
            case 'REMOVE_MACHINE':
                console.log('removeMachine', action.index, state.machines, remove)
                return {
                    ...state,
                    machines: remove(action.index, state.machines)
                }
            case 'EDIT_ADD_MACHINE':
                // rest operator
                const { $key, ...editMachines } = action.editMachines // remove child key to use 0 1 2 3 without edit original

                if (state.editMachines && editMachines) {
                    return {
                        // spread operator
                        ...state,
                        editMachines: [...state.editMachines, editMachines]
                    }
                }
                return state
            case 'EDIT_REMOVE_MACHINE':
                console.log('editRemoveMachine', action.index, state.editMachines, remove)

                if (state.editMachines) {
                    return {
                        ...state,
                        editMachines: remove(action.index, state.editMachines)
                    }
                }
                return state
            case 'EDIT_SET_MACHINE':
                return { ...state, editMachines: action.editMachines }
            case 'CLEAR_MACHINE':
                return []
            default:
                return state
        }
    };
    const store = Redux.createStore(reducer, initial);
    ReduxMixin = PolymerRedux(store);

</script>