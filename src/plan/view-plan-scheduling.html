<link rel="import" href="/bower_components/polymer/polymer-element.html">
<link rel="import" href="/bower_components/app-layout/app-grid/app-grid-style.html">
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">
<link rel="import" href="/bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="/bower_components/paper-toast/paper-toast.html">
<link rel="import" href="/bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="/bower_components/vaadin-charts/vaadin-charts.html">
<link rel="import" href="/bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="/bower_components/vaadin-grid/vaadin-grid-sorter.html">
<link rel="import" href="/lib/google-chart.html">
<link rel="import" href="../view-setup.html">
<link rel="import" href="../style/shared-styles.html">
<link rel="import" href="../style/flat-button.html">
<script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
<script src="https://www.amcharts.com/lib/3/serial.js"></script>
<script src="https://www.amcharts.com/lib/3/gantt.js"></script>
<script src="https://www.amcharts.com/lib/3/themes/light.js"></script>
<script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>

<dom-module id="view-plan-scheduling">
    <template>
        <style include="shared-styles app-grid-style flat-button">
             :host {
                margin: 10px;
                display: block;
                --app-grid-columns: 1;
                --app-grid-item-height: 50%;
            }

            .btn {
                margin: 20px 10px 0 0;
                width: 250px;
            }

            .order-schedule-info {
                margin: 10px 0;
            }

            .order-schedule-info>p {
                margin: 10px 0;
            }
            /* gantt chart */

            #chartdiv {
                width: 100%;
                height: 500px;
            }

            .amcharts-category-axis>text {
                cursor: pointer;
            }

            @media (min-width: 360px) and (max-width: 768px) {
                .btn {
                    width: 100%;
                }
            }


            vaadin-grid#material {

                font-family: Roboto, sans-serif;
                --divider-color: rgba(0, 0, 0, var(--dark-divider-opacity));

                --vaadin-grid-cell: {
                    padding: 0;
                }
                ;

                --vaadin-grid-header-cell: {
                    height: 64px;
                    color: rgba(0, 0, 0, var(--dark-secondary-opacity));
                    font-size: 12px;
                }
                ;

                --vaadin-grid-body-cell: {
                    height: 48px;
                    color: rgba(0, 0, 0, var(--dark-primary-opacity));
                    font-size: 13px;
                }
                ;

                --vaadin-grid-body-row-hover-cell: {
                    background-color: var(--paper-grey-200);
                }
                ;

                --vaadin-grid-body-row-selected-cell: {
                    background-color: var(--paper-grey-100);
                }
                ;

                --vaadin-grid-focused-cell: {
                    box-shadow: none;
                    font-weight: bold;
                }
                ;
            }

            vaadin-grid#material .cell {
                overflow: hidden;
                text-overflow: ellipsis;
                padding-right: 56px;
            }

            vaadin-grid#material .cell.last {
                padding-right: 24px;
            }

            vaadin-grid#material .cell.numeric {
                text-align: right;
            }

            vaadin-grid#material paper-checkbox {
                --primary-color: var(--paper-indigo-500);
                margin: 0 24px;
            }

            vaadin-grid#material vaadin-grid-sorter {
                --vaadin-grid-sorter-arrow: {
                    display: none !important;
                }
                ;
            }

            vaadin-grid#material vaadin-grid-sorter .cell {
                flex: 1;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            vaadin-grid#material vaadin-grid-sorter iron-icon {
                transform: scale(0.8);
            }

            vaadin-grid#material vaadin-grid-sorter:not([direction]) iron-icon {
                color: rgba(0, 0, 0, var(--dark-disabled-opacity));
            }

            vaadin-grid#material vaadin-grid-sorter[direction] {
                color: rgba(0, 0, 0, var(--dark-primary-opacity));
            }

            vaadin-grid#material vaadin-grid-sorter[direction=desc] iron-icon {
                transform: scale(0.8) rotate(180deg);
            }
        </style>
        <firebase-auth app-name="smart-mes" id="auth" user="{{user}}"></firebase-auth>
        <firebase-document app-name="smart-mes" id="userData" path="/user/[[user.uid]]" data="{{k}}"></firebase-document>
        <firebase-document app-name="smart-mes" id="factoryProfile" path="/data/[[k.key]]/factoryData/profile" data="{{factoryProfile}}"></firebase-document>
        <firebase-document app-name="smart-mes" id="factoryOperation" path="/data/[[k.key]]/factoryData/operation" data="{{factoryOperation}}"></firebase-document>
        <firebase-document app-name="smart-mes" id="factoryPerformance" path="/data/[[k.key]]/factoryData/performance" data="{{factoryPerformance}}"></firebase-document>
        <firebase-document app-name="smart-mes" id="factorySchedule" path="/data/[[k.key]]/factoryData/schedule" data="{{factorySchedule}}"></firebase-document>

        <firebase-query app-name="smart-mes" id="schedulingQuery" path="/data/[[k.key]]/scheduleData/[[getStationIndex(station)]]"
            data="{{scheduleItems}}"></firebase-query>

        <firebase-query app-name="smart-mes" id="orderQuery" path="/data/[[k.key]]/orderData" order-by-child="order_delivery" data="{{orderItems}}"></firebase-query>
        <firebase-query app-name="smart-mes" id="stationQuery" path="/data/[[k.key]]/factoryData/station" order-by-child="st_number"
            data="{{stationItems}}"></firebase-query>
        <app-indexeddb-mirror key="station-data" data="{{stationItems}}" persisted-data="{{persistedStationData}}"></app-indexeddb-mirror>
        <app-localstorage-document key="app-lang" data="{{language}}"></app-localstorage-document>
        <iron-ajax url="../data/chart.json" auto handle-as="json" last-response="{{chartData}}"></iron-ajax>
        <ul class="app-grid">
            <li>
                <div class="card">
                    <h1 class="title">Order Scheduling</h1>
                    <div class="order-schedule-info">
                        <p>Next Reschedule: [[getNextInterval(factorySchedule.start_interval, factorySchedule.interval)]]</p>
                        <p>Production Model: [[factoryProfile.model]]</p>
                        <p>Station Concurrency: [[factoryProfile.concurrency]]</p>
                    </div>
                    <vaadin-grid id="material" items="[[orderItems]]" size="100">
                        <vaadin-grid-selection-column width="66px" flex="0" select-all="{{selectAll}}">
                            <template class="header">
                                <paper-checkbox checked="{{selectAll}}"></paper-checkbox>
                            </template>
                            <template>
                                <paper-checkbox checked="{{selected}}"></paper-checkbox>
                            </template>
                        </vaadin-grid-selection-column>

                        <vaadin-grid-column width="100px" flex="0">
                            <template class="header">
                                <vaadin-grid-sorter path="order_no">
                                    <div class="cell">Order No.</div>
                                </vaadin-grid-sorter>
                            </template>
                            <template>
                                <div class="cell">[[item.order_no]]</div>
                            </template>
                        </vaadin-grid-column>

                        <vaadin-grid-column flex="2">
                            <template class="header">
                                <div class="cell">Customer</div>
                            </template>
                            <template>
                                <div class="cell">[[item.order_customer]]</div>
                            </template>
                        </vaadin-grid-column>

                        <vaadin-grid-column>
                            <template class="header">
                                <vaadin-grid-sorter path="order_product_name">
                                    <div class="cell">
                                        <span>Product</span>
                                    </div>
                                </vaadin-grid-sorter>
                            </template>
                            <template>
                                <div class="cell">[[item.order_product_name]]</div>
                            </template>
                        </vaadin-grid-column>

                        <vaadin-grid-column>
                            <template class="header">
                                <vaadin-grid-sorter path="order_quantity">
                                    <div class="cell">
                                        <span>Quantity</span>
                                    </div>
                                </vaadin-grid-sorter>
                            </template>
                            <template>
                                <div class="cell">[[item.order_quantity]]</div>
                            </template>
                        </vaadin-grid-column>

                        <vaadin-grid-column flex="1">
                            <template class="header">
                                <vaadin-grid-sorter path="order_duration">
                                    <div class="cell">Duration (hr)</div>
                                </vaadin-grid-sorter>
                            </template>
                            <template>
                                <div class="cell">[[getOrderDuration(item.order_duration)]]</div>
                            </template>
                        </vaadin-grid-column>

                        <vaadin-grid-column flex="1">
                            <template class="header">
                                <vaadin-grid-sorter path="order_delivery">
                                    <div class="cell">Remaining</div>
                                </vaadin-grid-sorter>
                            </template>
                            <template>
                                <div class="cell">[[getRemainDay(item.order_delivery, item.order_status, item.$key)]] days</div>
                            </template>
                        </vaadin-grid-column>

                        <vaadin-grid-column flex="1">
                            <template class="header">
                                <vaadin-grid-sorter path="order_delivery">
                                    <div class="cell">Delivery</div>
                                </vaadin-grid-sorter>
                            </template>
                            <template>
                                <div class="cell">[[getDeliveryDate(item.order_delivery)]]</div>
                            </template>
                        </vaadin-grid-column>

                        <vaadin-grid-column flex="1">
                            <template class="header">
                                <vaadin-grid-sorter path="order_status">
                                    <div class="cell">Status</div>
                                </vaadin-grid-sorter>
                            </template>
                            <template>
                                <div class="cell" style$="color:[[getColorStatus(item.order_status)]]">[[getOrderStatus(item.order_status)]]</div>
                            </template>
                        </vaadin-grid-column>

                        <vaadin-grid-column width="100px" flex="0">
                            <template class="header">
                                <div class="cell numeric last">Cancel</div>
                            </template>
                            <template>
                                <div class="cell numeric last">
                                    <paper-icon-button on-tap="_deleteOrder" order="[[item]]" icon="vaadin:close-small" title="Delete" disabled="[[isDeletable(item.order_status)]]"></paper-icon-button>
                                </div>
                            </template>
                        </vaadin-grid-column>

                    </vaadin-grid>
                    <div class="center">
                        <flat-button class="btn" on-tap="_refreshStatus"><button>Refresh</button></flat-button>
                        <flat-button class="btn thunderbird" on-tap="_parallelSchedule"><button>Reschedule</button></flat-button>
                    </div>
                </div>
            </li>
            <li>
                <div class="card">
                    <h1 class="title">Job Scheduling</h1>
                    Selected Station: [[station]]

                    <vaadin-grid id="material" items="[[scheduleItems]]" size="100">
                        <vaadin-grid-column width="100px" flex="0">
                            <template class="header">
                                <div class="cell">Station</div>
                            </template>
                            <template>
                                <div class="cell">[[station]]</div>
                            </template>
                        </vaadin-grid-column>

                        <vaadin-grid-column flex="1">
                            <template class="header">
                                <div class="cell">Order No.</div>
                            </template>
                            <template>
                                <div class="cell">[[item.order_no]]</div>
                            </template>
                        </vaadin-grid-column>

                        <vaadin-grid-column flex="2">
                            <template class="header">
                                <div class="cell">Product</div>
                            </template>
                            <template>
                                <div class="cell">[[item.order_product]]</div>
                            </template>
                        </vaadin-grid-column>

                        <vaadin-grid-column>
                            <template class="header">
                                <div class="cell">
                                    <span>Part</span>
                                </div>
                            </template>
                            <template>
                                <div class="cell">[[item.job_part]]</div>
                            </template>
                        </vaadin-grid-column>

                        <vaadin-grid-column>
                            <template class="header">

                                <div class="cell">
                                    <span>Quantity</span>
                                </div>

                            </template>
                            <template>
                                <div class="cell">[[item.job_quantity]]</div>
                            </template>
                        </vaadin-grid-column>

                        <vaadin-grid-column flex="1">
                            <template class="header">

                                <div class="cell">Workload</div>

                            </template>
                            <template>
                                <div class="cell">[[item.job_workload]] mins.</div>
                            </template>
                        </vaadin-grid-column>

                        <vaadin-grid-column flex="1">
                            <template class="header">

                                <div class="cell">Used Machines</div>

                            </template>
                            <template>
                                <div class="cell">[[item.job_machine]]</div>
                            </template>
                        </vaadin-grid-column>

                        <vaadin-grid-column flex="1">
                            <template class="header">

                                <div class="cell">Status</div>

                            </template>
                            <template>
                                <div class="cell" style$="color:[[getColorStatus(item.job_status)]]">[[getOrderStatus(item.job_status)]]</div>
                            </template>
                        </vaadin-grid-column>

                        <!-- <vaadin-grid-column width="100px" flex="0">
                            <template class="header">
                                <div class="cell numeric last">Cancel</div>
                            </template>
                            <template>
                                <div class="cell numeric last">
                                    <paper-icon-button on-tap="_deleteOrder" order="[[item]]" icon="vaadin:close-small" title="Delete" disabled="[[isDeletable(item.order_status)]]"></paper-icon-button>
                                </div>
                            </template>
                        </vaadin-grid-column> -->

                    </vaadin-grid>
                    <div class="center">
                        <iron-selector selected="{{station}}" attr-for-selected="name" fallback-selection="1" role="navigation">
                            <template is="dom-repeat" items="[[persistedStationData]]" as="stationItem">
                                <flat-button class="btn" name="[[stationItem.st_number]]"><button>Station [[stationItem.st_number]]</button></flat-button>
                            </template>
                        </iron-selector>
                    </div>
                </div>
            </li>

            <li>
                <div class="card">
                    <h1 class="title">Job Scheduling Gantt Chart</h1>
                    <!-- <div id="chart_div"></div> -->
                </div>
            </li>
        </ul>
    </template>
    <script>
        class ViewPlanScheduling extends Polymer.mixinBehaviors([Polymer.FirebaseDatabaseBehavior, Polymer.AppLocalizeBehavior],
            Polymer.Element) {
            static get is() {
                return 'view-plan-scheduling'
            }

            static get properties() {
                return {
                    station: {
                        type: String,
                        reflectToAttribute: true
                    },
                    language: String,
                    status: String,
                    orderItems: Object,
                    factoryPerformance: Object,
                    factoryOperation: Object,
                    factoryProfile: Object,
                    scheduleItems: Object,
                    chartData: Object,
                    chartProperties: Object
                }
            }
            ready() {
                super.ready()
                this.initialGanttChart()
            }

            connectedCallback() {
                super.connectedCallback()
                this.loadResources(this.resolveUrl('../../data/locales.json'))
                //this.parallelSchedule();

            }

            initialGanttChart() {
                AmCharts.useUTC = true;
                this.chartProperties = AmCharts.makeChart(this.$.chart_div, {
                    "type": "gantt",
                    "theme": "light",
                    "addClassNames": true,
                    "marginRight": 70,
                    "period": "hh",
                    "dataDateFormat": "YYYY-MM-DD",
                    "balloonDateFormat": "JJ:NN",
                    "columnWidth": 0.5,
                    // "listeners": [{
                    //     "event": "rendered",
                    //     "method": handleRender
                    // }],
                    "valueAxis": {
                        "type": "date",
                        "minimum": 7,
                        "maximum": 31
                    },
                    "brightnessStep": 10,
                    "graph": {
                        "fillAlphas": 1,
                        "balloonText": "<b>[[task]]</b>: [[open]] [[value]]"
                    },
                    "rotate": true,
                    "categoryField": "category",
                    "segmentsField": "segments",
                    "colorField": "color",
                    "startDate": "2017-09-21",
                    "startField": "start",
                    "endField": "end",
                    "durationField": "duration",
                    "dataProvider": [{
                        "category": "John",
                        "url": "https://www.google.com.br",
                        "segments": [{
                            "start": 7,
                            "duration": 2,
                            "color": "#46615e",
                            "task": "Task #1"
                        }, {
                            "duration": 2,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }, {
                            "duration": 2,
                            "color": "#8dc49f",
                            "task": "Task #3"
                        }]
                    }, {
                        "category": "Smith",
                        "segments": [{
                            "start": 10,
                            "duration": 2,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }, {
                            "duration": 1,
                            "color": "#8dc49f",
                            "task": "Task #3"
                        }, {
                            "duration": 4,
                            "color": "#46615e",
                            "task": "Task #1"
                        }]
                    }, {
                        "category": "Ben",
                        "segments": [{
                            "start": 12,
                            "duration": 2,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }, {
                            "start": 16,
                            "duration": 2,
                            "color": "#FFE4C4",
                            "task": "Task #4"
                        }]
                    }, {
                        "category": "Mike",
                        "segments": [{
                            "start": 9,
                            "duration": 6,
                            "color": "#46615e",
                            "task": "Task #1"
                        }, {
                            "duration": 4,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }]
                    }, {
                        "category": "Lenny",
                        "segments": [{
                            "start": 8,
                            "duration": 1,
                            "color": "#8dc49f",
                            "task": "Task #3"
                        }, {
                            "duration": 4,
                            "color": "#46615e",
                            "task": "Task #1"
                        }]
                    }, {
                        "category": "Scott",
                        "segments": [{
                            "start": 15,
                            "duration": 3,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }]
                    }, {
                        "category": "Julia",
                        "segments": [{
                            "start": 9,
                            "duration": 2,
                            "color": "#46615e",
                            "task": "Task #1"
                        }, {
                            "duration": 1,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }, {
                            "duration": 8,
                            "color": "#8dc49f",
                            "task": "Task #3"
                        }]
                    }, {
                        "category": "Bob",
                        "segments": [{
                            "start": 9,
                            "duration": 8,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }, {
                            "duration": 7,
                            "color": "#8dc49f",
                            "task": "Task #3"
                        }]
                    }, {
                        "category": "Kendra",
                        "segments": [{
                            "start": 11,
                            "duration": 8,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }, {
                            "start": 16,
                            "duration": 2,
                            "color": "#FFE4C4",
                            "task": "Task #4"
                        }]
                    }, {
                        "category": "Tom",
                        "segments": [{
                            "start": 9,
                            "duration": 4,
                            "color": "#46615e",
                            "task": "Task #1"
                        }, {
                            "duration": 3,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }, {
                            "duration": 5,
                            "color": "#8dc49f",
                            "task": "Task #3"
                        }]
                    }, {
                        "category": "Kyle",
                        "segments": [{
                            "start": 6,
                            "duration": 3,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }]
                    }, {
                        "category": "Anita",
                        "segments": [{
                            "start": 12,
                            "duration": 2,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }, {
                            "start": 16,
                            "duration": 2,
                            "color": "#FFE4C4",
                            "task": "Task #4"
                        }]
                    }, {
                        "category": "Jack",
                        "segments": [{
                            "start": 8,
                            "duration": 10,
                            "color": "#46615e",
                            "task": "Task #1"
                        }, {
                            "duration": 2,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }]
                    }, {
                        "category": "Kim",
                        "segments": [{
                            "start": 12,
                            "duration": 2,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }, {
                            "duration": 3,
                            "color": "#8dc49f",
                            "task": "Task #3"
                        }]
                    }, {
                        "category": "Aaron",
                        "segments": [{
                            "start": 18,
                            "duration": 2,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }, {
                            "duration": 2,
                            "color": "#FFE4C4",
                            "task": "Task #4"
                        }]
                    }, {
                        "category": "Alan",
                        "segments": [{
                            "start": 17,
                            "duration": 2,
                            "color": "#46615e",
                            "task": "Task #1"
                        }, {
                            "duration": 2,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }, {
                            "duration": 2,
                            "color": "#8dc49f",
                            "task": "Task #3"
                        }]
                    }, {
                        "category": "Ruth",
                        "segments": [{
                            "start": 13,
                            "duration": 2,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }, {
                            "duration": 1,
                            "color": "#8dc49f",
                            "task": "Task #3"
                        }, {
                            "duration": 4,
                            "color": "#46615e",
                            "task": "Task #1"
                        }]
                    }, {
                        "category": "Simon",
                        "segments": [{
                            "start": 10,
                            "duration": 3,
                            "color": "#727d6f",
                            "task": "Task #2"
                        }, {
                            "start": 17,
                            "duration": 4,
                            "color": "#FFE4C4",
                            "task": "Task #4"
                        }]
                    }],
                    "valueScrollbar": {
                        "autoGridCount": true
                    },
                    "chartCursor": {
                        "cursorColor": "#55bb76",
                        "valueBalloonsEnabled": false,
                        "cursorAlpha": 0,
                        "valueLineAlpha": 0.5,
                        "valueLineBalloonEnabled": true,
                        "valueLineEnabled": true,
                        "zoomable": false,
                        "valueZoomable": true
                    },
                    "export": {
                        "enabled": true
                    },
                    "categoryAxis": {
                        "gridPosition": "start",
                        "gridAlpha": 0,
                        "tickPosition": "start",
                        "tickLength": 20
                    }
                });

                var links = {
                    'John': 'https://www.uol.com.br',
                    'Smith': 'https://www.google.com.br',
                    'Ben': 'https://www.terra.com.br',
                };

                // function handleRender(event) {
                //     console.log('rendered');
                //     this.chartProperties.categoryAxis.addListener("rollOverItem", function (event) {
                //         event.target.setAttr("cursor", "default");
                //         event.chart.balloon.borderColor = '#FF0000';
                //         event.chart.balloon.fillColor = '#FF0000';
                //         event.chart.balloon.color = '#FFFFFF';
                //         event.chart.balloon.followCursor(true);
                //         // event.chart.balloon.changeColor( '#FF0000');
                //         event.chart.balloon.showBalloon(event.value + " teste");
                //     });

                //     this.chartProperties.categoryAxis.addListener("rollOutItem", function (event) {
                //         event.chart.balloon.borderColor = '#000000';
                //         event.chart.balloon.fillColor = '#FFFFFF';
                //         event.chart.balloon.color = '#000000';
                //         event.chart.balloon.hide();
                //     });
                // };
            }


            getNextInterval(last_timestamp, interval) {
                if (!last_timestamp || !interval) return 0
                let current = Math.floor(Date.now() / 1000)
                let diff = current - last_timestamp
                let range = interval * 24 * 60 * 60
                if (diff <= range) {
                    let nextIntervalStamp = (last_timestamp * 1000) + (interval * 24 * 60 * 60 * 1000)
                    let nextIntervalDate = new Date(nextIntervalStamp)
                    let dd = nextIntervalDate.getDate()
                    let mm = nextIntervalDate.getMonth() + 1 // January is 0!
                    let yyyy = nextIntervalDate.getFullYear()
                    if (dd < 10) {
                        dd = '0' + dd
                    }
                    if (mm < 10) {
                        mm = '0' + mm
                    }
                    let nextInterval = dd + '/' + mm + '/' + yyyy
                    return nextInterval
                } else {
                    this.set('factorySchedule.start_interval', current)
                }
            }

            getOrderDuration(order_duration) {
                if (!order_duration) return 0
                return this._minutesToStr(order_duration)
            }

            getStationIndex(station) {
                return station - 1
            }

            getRemainDay(delivery_date, status, key) {
                if (!delivery_date) return 0
                const current_date = Math.round(new Date().getTime() / 1000.0);
                const remain = Math.round((delivery_date - current_date) / 86400);

                if (remain < 0) {
                    this.$.orderQuery.ref.child(key).update({
                        order_status: 'late'
                    });
                    return 0;
                } else if (status !== 'wip') {
                    this.$.orderQuery.ref.child(key).update({
                        order_status: 'waiting'
                    });
                    return remain;
                } else {

                    return remain;
                }
            }

            getDeliveryDate(timestamp) {
                let today = new Date(timestamp * 1000);
                let dd = today.getDate();
                let mm = today.getMonth() + 1; //January is 0!
                let yyyy = today.getFullYear();
                if (dd < 10) {
                    dd = '0' + dd
                }
                if (mm < 10) {
                    mm = '0' + mm
                }
                let deliveryDate = dd + '/' + mm + '/' + yyyy;
                return deliveryDate;
            }

            getOrderStatus(order_status) {
                switch (order_status) {
                    case 'waiting':
                        return 'WAITING'
                        break;
                    case 'wip':
                        return 'WIP'
                        break;
                    case 'done':
                        return 'DONE'
                        break;
                    case 'late':
                        return 'LATED'
                        break;
                    case 'cancel':
                        return 'CANCELED'
                        break;
                    default:
                        return 'N/A'
                }
            }

            getColorStatus(order_status) {
                switch (order_status) {
                    case 'waiting':
                        return '#FFB300'
                        break;
                    case 'wip':
                        return '#5E35B1'
                        break;
                    case 'done':
                        return '#7CB342'
                        break;
                    case 'late':
                        return '#E53935'
                        break;
                    case 'cancel':
                        return '#E53935'
                        break;
                    default:
                        return '#202020'
                }
            }

            _refreshStatus() {
                window.alert('Your schedule is the lastest update');
            }

            _rescheduleOrder() {
                window.alert('Note: Orders that are working in process will not able to reschedule.');
            }

            _parallelSchedule() {
                let order = this.orderItems;
                if (order) {

                    let concurrent = this.factoryProfile.concurrencys;
                    let order_part_wip = []
                    let order_quantity_wip = []
                    order_part_wip = order
                        .filter(order => order.order_status === 'waiting')
                        .map(order => order.order_product_part)

                    order_quantity_wip = order
                        .filter(order => order.order_status === 'waiting')
                        .map(order => order.order_quantity)
                    console.log(order_part_wip)

                    let jobCycle = order_part_wip[0][0].cycle;

                    console.log(jobCycle);
                    let jobWorkload = jobCycle.map((x) => x * order_quantity_wip[0])
                    console.log(jobWorkload);

                    let station_quantity = this.stationItems.length

                    // this.$.schedulingQuery.ref.push({
                    // })

                }
            }

            isDeletable(order_status) {
                switch (order_status) {
                    case 'waiting':
                        return false
                        break;
                    case 'wip':
                        return true
                        break;
                    case 'done':
                        return false
                        break;
                    case 'lated':
                        return false
                        break;
                    case 'cancel':
                        return false
                        break;
                    default:
                        return false
                }
            }

            // CONVERT TIME TO STRING
            _minutesToStr(minute) {
                let sign = '';
                if (minute < 0) {
                    sign = '0';
                }
                let hours = this._leftPad(Math.floor(Math.abs(minute) / 60));
                let minutes = this._leftPad(Math.round(Math.abs(minute) % 60));
                return sign + hours + 'hrs ' + minutes + 'min';
            }

            // ADD 0 to numbers less than 10,Eg: 2 -> 02 
            _leftPad(number) {
                return ((number < 10 && number >= 0) ? '0' : '') + number;
            }

            _deleteOrder(e) {
                if (confirm("Delete this order ?") == true) {
                    let key = e.currentTarget.order.$key;
                    this.$.orderQuery.ref.child(key).remove();
                    alert("Delete order successfully");
                }
            }

        }
        customElements.define(ViewPlanScheduling.is, ViewPlanScheduling)
    </script>
</dom-module>