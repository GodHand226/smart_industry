<link rel="import" href="/bower_components/polymer/polymer-element.html">
<link rel="import" href="/bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../view-app.html">
<link rel="import" href="../style/shared-styles.html">
<link rel="import" href="../style/flat-button.html">

<dom-module id="view-dashboard-statistic">
  <template>
    <style include="shared-styles app-grid-style flat-button">
       :host {
        margin: 10px;
        display: block;
        --app-grid-columns: 1;
        --app-grid-item-height: 50%;
      }

      h1.title {
        text-align: center;
        margin: 20px 0 30px 0;
        font-size: 1.75rem;
      }

      google-chart {
        height: 100%;
        width: 100%;
      }

      @media (min-width: 360px) and (max-width: 768px) {
        #column {
          width: 100%;
        }
      }
    </style>
    <firebase-auth app-name="smart-mes" id="auth" user="{{user}}"></firebase-auth>
    <firebase-document app-name="smart-mes" id="userData" path="/user/[[user.uid]]" data="{{k}}"></firebase-document>
    <firebase-query app-name="smart-mes" id="orderHistoryQuery" path="/data/[[k.key]]/historyData/order" data="{{orderHistoryData}}"></firebase-query>
    <app-localstorage-document key="app-lang" data="{{language}}"></app-localstorage-document>
    <ul class="app-grid">
      <li>
        <div class="card" id="chartContainer">

          <h1 class="title">Productivity Statistic</h1>
          <google-chart id="column" type="column" options="[[columnOptions]]" cols='[{"label": "Data", "type": "string"},{"label": "Value", "type": "number"}]'
            rows='[ ["Col1", 2.0],["Col2", 9.0],["Col3",
          5.0] ]'></google-chart>

          <flat-button class="btn" on-tap="clearStatistic">
            <button>Reset Statistic</button>
          </flat-button>
          <paper-toast id="toast" always-on-top horizontal-align="right" text="No statistic found"></paper-toast>

        </div>
      </li>
      <li>
        <div class="card">
          <h1 class="title">Monthly Order Statistic</h1>

        </div>
      </li>
    </ul>
    <paper-toast id="toastAlert" always-on-top horizontal-align="right" text="{{localize(alertText)}}"></paper-toast>
  </template>
  <script>
    /**
     * @ViewDashboardStatistic
     * @polymer 
     * @extends {Polymer.Element}
     * @appliesMixin Polymer.AppLocalizeBehavior
     */
    class ViewDashboardStatistic extends Polymer.mixinBehaviors([Polymer.AppLocalizeBehavior],
      Polymer.Element) {
      static get is() {
        return 'view-dashboard-statistic';
      }

      static get properties() {
        return {
          language: String,
          orderHistoryData: Object,
          columnOptions: Object,
          width: Number,
          height: Number
        }
      }
      connectedCallback() {
        super.connectedCallback();
        this.loadResources(this.resolveUrl('../../data/locales.json'));
        requestAnimationFrame(this._installListeners.bind(this))
      }

      _installListeners() {
        // listen for custom events on main page
        this.addEventListener('iron-resize', (e) => this._setChartSize(e))
      }

      _setChartSize() {
        this.width = this.$.chartContainer.offsetWidth;
        this.height = this.$.chartContainer.offsetHeight;
        if (this.width > 0) {
          this.columnOptions = {
            width: this.width - 40,
            height: this.height,
            chart: {
              title: 'Order Statistic'
            },
            vAxis: {
              "minValue": 0,
              "maxValue": 10
            },
            tooltip: {
              isHtml: true
            }
          }
          this._initialChart()
          this.$.column.redraw()
        }
      }

      clearStatistic() {
        if (confirm("Are you sure do you want to clear product order history ?") == true) {
          this.$.orderHistoryQuery.ref.remove()
          this.alertText = "notification-delete-successfully"
          this.$.toastAlert.open()
        }
      }
    }
    customElements.define(ViewDashboardStatistic.is, ViewDashboardStatistic);
  </script>
</dom-module>